<!DOCTYPE html>
<html>
<head>
	<title>testi</title>
	<meta charset="utf-8">
	<style type="text/css">
	#mouseoverlay
	{
		position: absolute;
		width: 100%;
		height: 100%;
		top: 0;
		left: 0;
		/*background-color: rgba(10, 10, 10, 0.5);*/

		pointer-events: auto;
		pointer-events: none;
	}

	body
	{
		width: 100vw;
		height: 100vh;
		margin: 0;
	}

	fieldset
	{
		position: absolute;
		z-index: 2;
	}
	</style>
</head>
<body>
	<canvas id="mouseoverlay"></canvas>

	<script type="text/javascript">
		let globMaxDistanceForLinesSquared = 10000;
		let globTimeBetweenPoints = 50;

		window.mouseMoveTimer = null;
		window.trackMouseMove = false;
		window.mouseCoords = [];
		window.alreadyDrawnPoints = [];
		window.drawCanvas = document.getElementById("mouseoverlay");

		// set canvas size
		window.drawCanvas.width = window.innerWidth;
		window.drawCanvas.height = window.innerHeight;


		window.mouseMoveTimer = window.setInterval( function()
		{
			// enable mouse tracking every 100 ms
			window.trackMouseMove = true;
		}, globTimeBetweenPoints);

		function mouseSafeTimer(evt)
		{
			if (!window.trackMouseMove)
			{
				return
			}

			safeMouseCoords(evt);
			window.trackMouseMove = false;
		}

		function resizeCanvas()
		{
			// will erase the canvas
			window.drawCanvas.width = window.innerWidth;
			window.drawCanvas.height = window.innerHeight;
		}

		function safeMouseCoords(evt)
		{
			window.mouseCoords.push({"x": evt.clientX, "y": evt.clientY});
			drawPointsOnCanvas();
		}

		document.body.onmousemove = mouseSafeTimer;
		window.onresize = resizeCanvas;

		function getNewPoints()
		{
			let points = window.mouseCoords;
			window.mouseCoords = [];
			return points;
		}

		function getOldPoints()
		{
			return window.alreadyDrawnPoints ? window.alreadyDrawnPoints : [];
		}

		function addPointsToAlreadyDrawn(pointsArr)
		{
			window.alreadyDrawnPoints = window.alreadyDrawnPoints.concat(pointsArr);
		}

		function drawPointsOnCanvas()
		{
			let points = getNewPoints();

			let alreadyDrawnPoints = getOldPoints();
			let canvas = window.drawCanvas;
			let slicedArr = [];
			let maxDistanceForLinesSquared = globMaxDistanceForLinesSquared;
			let cSquared = maxDistanceForLinesSquared;
			let drawTransparency = 1;

			let ctx = canvas.getContext("2d");
			let radius = 1;

			// draw points
			points.forEach(function (ele)
			{
				ctx.beginPath();
				ctx.strokeColor = 'black';
				ctx.arc(ele.x, ele.y, radius, 0, 2*Math.PI);
				ctx.stroke();
			});

			// draw lines between all points
			points.forEach(function (point1, index)
			{
				alreadyDrawnPoints.forEach(function (point2)
				{
					cSquared = Math.pow(point1.x - point2.x, 2) + Math.pow(point1.y - point2.y, 2);
					if ( cSquared <= maxDistanceForLinesSquared )
					{
						drawTransparency = 1 - (1 / maxDistanceForLinesSquared * cSquared);
						ctx.strokeStyle = "rgba(228, 35, 19, " + drawTransparency + ")";
						ctx.beginPath();
						ctx.moveTo(point1.x, point1.y);
						ctx.lineTo(point2.x, point2.y);
						ctx.stroke();
					}
				});
			});

			//console.log(window.alreadyDrawnPoints.length);
			//window.alreadyDrawnPoints = window.alreadyDrawnPoints.concat(points);
			//setTimeout(drawPointsOnCanvas, 200);
			addPointsToAlreadyDrawn(points);
		}

		//drawPointsOnCanvas();
	</script>

	<fieldset>
		<legend>Options</legend>
		Connection range: <input type="range" min="1" max="70000" value="100" id="maxConnectDist">
		Time between Points: <input type="range" min="10" max="200" value="10" id="maxTimeBetweenPoints">
		<button onclick="reset()">reset</button>

		<script type="text/javascript">
			let maxConnectDistSlider = document.getElementById("maxConnectDist");
			maxConnectDistSlider.value = globMaxDistanceForLinesSquared;

			maxConnectDistSlider.oninput = function()
			{
				globMaxDistanceForLinesSquared = this.value;
			}

			let maxTimeBetweenPointsSlider = document.getElementById("maxTimeBetweenPoints");
			maxTimeBetweenPointsSlider.value = globTimeBetweenPoints;

			maxTimeBetweenPointsSlider.oninput = function()
			{
				globTimeBetweenPoints = this.value;
				clearInterval(window.mouseMoveTimer);

				window.mouseMoveTimer = window.setInterval( function()
				{
					// enable mouse tracking every 100 ms
					window.trackMouseMove = true;
				}, globTimeBetweenPoints);
			}

			function reset()
			{
				window.mouseCoords = [];
				window.alreadyDrawnPoints = [];
				window.drawCanvas.getContext("2d").clearRect(0, 0, window.drawCanvas.width, window.drawCanvas.height);
				console.log("cleared");
			}
		</script>
	</fieldset>
</body>
</html>